# 第5章 生产环境监测

## 5.1 服务器性能日常监测

- 服务器平均负载：在单位时间内系统处于“可运行状态”或“不可中断状态”的进程的平均数，即活跃进程的平均数。
- CPU上下文切换：
    - 进程上下文切换：受到操作系统管理。
    - 线程上下文切换：在同一个进程中两个线程的切换，处理在某个时间点CPU寄存器和程序计数器的内容。
    - 中断上下文切换：切换”执行内核态中断服务程序所必需的状态“。
    
## 5.2 CPU的性能瓶颈分析

- 影响CPU性能的指标：
    - CPU使用率：非空闲时间占总CPU运行时间的百分比。
    - 平均负载
    - 上下文切换
    - CPU缓存命中率

- CPU性能分析工具：
    - `top`命令：获取CPU的使用率、平均负载和”僵尸“进程等信息。
    - `vmstat`命令：获取上下文切换次数、中断次数、运行状态和不可中断状态的进程数。
    - `pidstat`命令：获取进程用户态CPU使用率、系统内核CPU使用率、自愿上下文切换和非自愿上下文切换情况。

## 5.3 优化服务器性能

- CPU性能优化：应用程序优化、系统优化
- 内存泄漏问题：
    - 使用`vmstat`命令查看内存是否变动异常
    - 使用`top`命令查看占用内存空间不正常的进程
    - 使用`memleak`监测内存泄漏