# 第7章 缓存设计

## 7.1 缓存分类

- 本地缓存：客户端缓存、CDN缓存、反向代理缓存、应用程序缓存
- 远程缓存：`Memcached`、`Redis`为代表
- 内存型缓存：将数据存储在内存中。
- 持久化型缓存：将数据存储在`SSD`或`Fusion-io`等固态技术介质中。

## 7.2 缓存的使用技巧

- 缓存读写策略：`Cache Aside Pattern`旁路缓存策略
- 多级缓存：用户层、CDN层、反向代理层、分布式缓存层、服务层、存储层。

## 7.3 缓存架构设计

### 7.3.1 缓存组件的选型

| | `Memcached` | `Redis` |
| :---: | :--- | :--- |
| 存储方式 | 存储在内存中 | 部分数据保存在硬盘中 |
| 数据支持类型 | 只支持简单的`key-value`数据类型 | 支持多种数据类型 |
| `value`大小 | 1MB | 1GB |

### 7.3.2 缓存分布的设计

- 分布算法：取模算法、一致性Hash算法。
- 读写访问实施：
    - 代码层开发，在代码`client`层感知分布策略，直接进行读写。
    - 利用代理实现读写路由。
    
### 7.3.3 缓存架构部署

- 分池访问：对于核心的、高并发访问的数据，拆分到不同的缓存池中。
- 分层访问
- 多IDC部署
- 缓存组件组合
- 运维监控

## 7.4 缓存雪崩

- 缓存”雪崩“的情况：因缓存不支持rehash（穿透）、缓存支持rehash（过载）。
- 解决方案：
    - 对DB访问增加读开关
    - 给缓存系统增加多个副本
    - 对缓存系统进行实时监控
    - 容错降级机制
    